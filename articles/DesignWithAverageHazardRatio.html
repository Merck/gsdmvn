<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Design Using Average Hazard Ratio â€¢ gsdmvn</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Design Using Average Hazard Ratio">
<meta property="og:description" content="gsdmvn">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gsdmvn</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/DesignWithAverageHazardRatio.html">Design Using Average Hazard Ratio</a>
    </li>
    <li>
      <a href="../articles/DesignWithSpending.html">Trial design with spending under NPH</a>
    </li>
    <li>
      <a href="../articles/NPEbackground.html">Non-Proportional Effect Size in Group Sequential Design</a>
    </li>
    <li>
      <a href="../articles/NPEbounds.html">Computing Bounds Under Non-Constant Treatment Effect</a>
    </li>
    <li>
      <a href="../articles/PowerEvaluationWithSpending.html">Power Evaluation with Spending bounds</a>
    </li>
    <li>
      <a href="../articles/QuickStart.html">Quick Start for NPH Sample Size and Power</a>
    </li>
    <li>
      <a href="../articles/SpendingTimeExamples.html">Spending Time Examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="DesignWithAverageHazardRatio_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Design Using Average Hazard Ratio</h1>
                        <h4 class="author">Keaven M. Anderson</h4>
            
            <h4 class="date">12/21/2020</h4>
      
      
      <div class="hidden name"><code>DesignWithAverageHazardRatio.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># packages used</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gsDesign</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://merck.github.io/gsDesign2/">gsDesign2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gsdmvn</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com/">gt</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></code></pre></div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><span class="citation">Jennison and Turnbull (2000)</span></p>
</div>
<div id="scenarios" class="section level2">
<h2 class="hasAnchor">
<a href="#scenarios" class="anchor"></a>Scenarios</h2>
<p>Expected enrollment duration is 24 months with piecewise constant enrollment rates escalating every 2 months until month 6 where enrollment is assumed to have reached steady state. For alternate scenarios, enrollment will occur at a faster than planned rate. For both scenarios, we assume for initial illustrations that the total enrollment is 100 subjects.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 6 month ramp-up of enrollment, 24 months enrollment time target</span>
<span class="va">enroll24</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>Stratum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"All"</span>,<span class="fl">4</span><span class="op">)</span>, 
                           duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fl">18</span><span class="op">)</span>,
                           rate <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>
<span class="co"># Set rates to enroll 100 subjects</span>
<span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">enroll24</span><span class="op">$</span><span class="va">duration</span> <span class="op">*</span> <span class="va">enroll24</span><span class="op">$</span><span class="va">rate</span><span class="op">)</span>
<span class="va">enroll24</span><span class="op">$</span><span class="va">rate</span> <span class="op">&lt;-</span> <span class="va">enroll24</span><span class="op">$</span><span class="va">rate</span> <span class="op">*</span> <span class="fl">100</span> <span class="op">/</span> <span class="va">N</span>

<span class="co"># Enroll in 16 months, same ramp-up</span>
<span class="va">enroll16</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>Stratum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"All"</span>,<span class="fl">4</span><span class="op">)</span>, 
                           duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fl">12</span><span class="op">)</span>,
                           rate <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>
<span class="co"># Set rates to enroll 100 subjects</span>
<span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">enroll16</span><span class="op">$</span><span class="va">duration</span> <span class="op">*</span> <span class="va">enroll16</span><span class="op">$</span><span class="va">rate</span><span class="op">)</span>
<span class="va">enroll16</span><span class="op">$</span><span class="va">rate</span> <span class="op">&lt;-</span> <span class="va">enroll16</span><span class="op">$</span><span class="va">rate</span> <span class="op">*</span> <span class="fl">100</span> <span class="op">/</span> <span class="va">N</span>
<span class="co"># Put these in a single tibble by scenario</span>
<span class="co"># We will use 16 month enrollment for delayed effect and crossing hazards</span>
<span class="co"># scenarios</span>
<span class="va">enrollRates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">enroll24</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="st">"PH"</span><span class="op">)</span>,
                     <span class="va">enroll24</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="st">"Delayed effect 1"</span><span class="op">)</span>,
                     <span class="va">enroll16</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="st">"Delayed effect 2"</span><span class="op">)</span>,
                     <span class="va">enroll16</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="st">"Crossing"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>We will consider the following failure rate assumptions:</p>
<ul>
<li>PH: Proportional hazards is assumed.
<ul>
<li>Control group has exponential failure rate with a median of 12 months.</li>
<li>Constant hazard ratio of 0.7 (experimental/control).</li>
</ul>
</li>
<li>Delayed effect
<ul>
<li>Control group has exponential failure rate with a median of 10 months.</li>
<li>Hazard ratio of 1 for 6 months followed by a hazard ratio of 0.575.</li>
</ul>
</li>
<li>Crossing hazards
<ul>
<li>Control group has exponential failure rate with a median of 10 months.</li>
<li>Hazard ratio of 1.5 for 4 months followed by a hazard ratio of 0.5.</li>
</ul>
</li>
</ul>
<p>Survival curves for these 3 scenarios are shown below:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">44</span><span class="op">)</span>
<span class="va">duration</span> <span class="op">&lt;-</span> <span class="va">Month</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">Month</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>
<span class="va">control_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">16</span>,<span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">14</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">14</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"PH"</span>,<span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Delayed effect"</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Crossing"</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,
                    Treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="fl">12</span><span class="op">)</span>,
                    Month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">Month</span>, <span class="fl">3</span><span class="op">)</span>,
                    duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">duration</span>, <span class="fl">3</span><span class="op">)</span>,
                    rate <span class="op">=</span> <span class="va">control_rate</span>,
                    hr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">.7</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">.575</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>,<span class="fl">1.5</span>, <span class="fl">.5</span>, <span class="fl">.5</span><span class="op">)</span><span class="op">)</span>,
<span class="op">)</span>
<span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">s</span>,
           <span class="va">s</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Treatment <span class="op">=</span> <span class="st">"Experimental"</span>,
                        rate <span class="op">=</span> <span class="va">rate</span> <span class="op">*</span> <span class="va">hr</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Scenario</span>, <span class="va">Treatment</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Survival <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">duration</span> <span class="op">*</span> <span class="va">rate</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">s</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Month</span>, y <span class="op">=</span> <span class="va">Survival</span>, col <span class="op">=</span> <span class="va">Scenario</span>, lty <span class="op">=</span> <span class="va">Treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">/</span><span class="fl">10</span>, lim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">42</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DesignWithAverageHazardRatio_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div id="average-hazard-ratio" class="section level2">
<h2 class="hasAnchor">
<a href="#average-hazard-ratio" class="anchor"></a>Average Hazard Ratio</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Durations to be used in common for all failure rate scenarios</span>
<span class="va">dur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">100</span><span class="op">)</span>
<span class="co"># Exponential failure, proportional hazards</span>
<span class="va">failRates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="st">"PH"</span>, Stratum <span class="op">=</span> <span class="st">"All"</span>, 
                          duration <span class="op">=</span> <span class="va">dur</span>, failRate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">14</span>,
                          hr <span class="op">=</span> <span class="fl">0.7</span>, dropoutRate <span class="op">=</span> <span class="fl">.001</span><span class="op">)</span>,
                   <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="st">"Delayed effect 1"</span>, Stratum <span class="op">=</span> <span class="st">"All"</span>, 
                          duration <span class="op">=</span> <span class="va">dur</span>, failRate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">11</span>,
                          hr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.6</span>, <span class="fl">.6</span><span class="op">)</span>, dropoutRate <span class="op">=</span> <span class="fl">.001</span><span class="op">)</span>,
                   <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="st">"Delayed effect 2"</span>, Stratum <span class="op">=</span> <span class="st">"All"</span>, 
                          duration <span class="op">=</span> <span class="va">dur</span>, failRate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">11</span>,
                          hr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">.7</span><span class="op">)</span>, dropoutRate <span class="op">=</span> <span class="fl">.001</span><span class="op">)</span>,
                   <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="st">"Crossing"</span>, Stratum <span class="op">=</span> <span class="st">"All"</span>, 
                          duration <span class="op">=</span> <span class="va">dur</span>, failRate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">11</span>,
                          hr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">.6</span>,<span class="fl">.6</span><span class="op">)</span>, dropoutRate <span class="op">=</span> <span class="fl">.001</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">hr</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="kw">for</span><span class="op">(</span><span class="va">g</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PH"</span>, <span class="st">"Delayed effect 1"</span>, <span class="st">"Delayed effect 2"</span>, <span class="st">"Crossing"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">hr</span> <span class="op">&lt;-</span> 
    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">hr</span>,
        <span class="fu"><a href="https://merck.github.io/gsDesign2/reference/AHR.html">AHR</a></span><span class="op">(</span>enrollRates <span class="op">=</span> <span class="va">enrollRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Scenario</span> <span class="op">==</span> <span class="va">g</span><span class="op">)</span>, 
            failRates <span class="op">=</span> <span class="va">failRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Scenario</span> <span class="op">==</span> <span class="va">g</span><span class="op">)</span>,
            totalDuration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.001</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">44</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
        <span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="va">g</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">hr</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Time</span>, y<span class="op">=</span><span class="va">AHR</span>, col <span class="op">=</span> <span class="va">Scenario</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">42</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DesignWithAverageHazardRatio_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">hr</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Time</span>, y<span class="op">=</span><span class="va">`Events`</span>, col <span class="op">=</span> <span class="va">Scenario</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">42</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DesignWithAverageHazardRatio_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="sample-size-and-events-by-scenario" class="section level2">
<h2 class="hasAnchor">
<a href="#sample-size-and-events-by-scenario" class="anchor"></a>Sample Size and Events by Scenario</h2>
<div id="fixed-design-using-ahr-and-logrank" class="section level3">
<h3 class="hasAnchor">
<a href="#fixed-design-using-ahr-and-logrank" class="anchor"></a>Fixed design using AHR and logrank</h3>
<p>We power a fixed design at 90% with 2.5% one-sided Type I error under the different scenarios under consideration.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ss_ahr_fixed</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="kw">for</span><span class="op">(</span><span class="va">g</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PH"</span>, <span class="st">"Delayed effect 1"</span>,<span class="st">"Delayed effect 2"</span>, <span class="st">"Crossing"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">ss_ahr_fixed</span> <span class="op">&lt;-</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ss_ahr_fixed</span>,
      <span class="fu"><a href="../reference/gs_design_ahr.html">gs_design_ahr</a></span><span class="op">(</span>enrollRates <span class="op">=</span> <span class="va">enrollRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Scenario</span> <span class="op">==</span> <span class="va">g</span><span class="op">)</span>,
                    failRates <span class="op">=</span> <span class="va">failRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Scenario</span> <span class="op">==</span> <span class="va">g</span><span class="op">)</span>,
                    analysisTimes <span class="op">=</span> <span class="fl">36</span>,
                    upper <span class="op">=</span> <span class="va">gs_b</span>, upar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">.975</span><span class="op">)</span>,
                    lower <span class="op">=</span> <span class="va">gs_b</span>, lpar <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,
                    alpha <span class="op">=</span> <span class="fl">.025</span>,
                    beta <span class="op">=</span> <span class="fl">.1</span>
                    <span class="op">)</span><span class="op">$</span><span class="va">bounds</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="va">g</span><span class="op">)</span>
      <span class="op">)</span>
<span class="op">}</span>
<span class="va">ss_ahr_fixed</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">N</span>, <span class="va">Events</span>, <span class="va">AHR</span>, <span class="va">Scenario</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>columns<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,decimals <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fl">4</span>, decimals <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>  <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_header.html">tab_header</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sample Size and Events Required by Scenario"</span>,
             subtitle <span class="op">=</span> <span class="st">"36 Month Trial duration, 2.5% One-sided Type 1 Error, 90% Power"</span><span class="op">)</span></code></pre></div>
<div id="olzqtgueus" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#olzqtgueus .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#olzqtgueus .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#olzqtgueus .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#olzqtgueus .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#olzqtgueus .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#olzqtgueus .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#olzqtgueus .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#olzqtgueus .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#olzqtgueus .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#olzqtgueus .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#olzqtgueus .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#olzqtgueus .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#olzqtgueus .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#olzqtgueus .gt_from_md > :first-child {
  margin-top: 0;
}

#olzqtgueus .gt_from_md > :last-child {
  margin-bottom: 0;
}

#olzqtgueus .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#olzqtgueus .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#olzqtgueus .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#olzqtgueus .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#olzqtgueus .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#olzqtgueus .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#olzqtgueus .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#olzqtgueus .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#olzqtgueus .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#olzqtgueus .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#olzqtgueus .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#olzqtgueus .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#olzqtgueus .gt_left {
  text-align: left;
}

#olzqtgueus .gt_center {
  text-align: center;
}

#olzqtgueus .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#olzqtgueus .gt_font_normal {
  font-weight: normal;
}

#olzqtgueus .gt_font_bold {
  font-weight: bold;
}

#olzqtgueus .gt_font_italic {
  font-style: italic;
}

#olzqtgueus .gt_super {
  font-size: 65%;
}

#olzqtgueus .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="table gt_table">
<thead class="gt_header">
<tr>
<th colspan="5" class="gt_heading gt_title gt_font_normal" style>Sample Size and Events Required by Scenario</th>
    </tr>
<tr>
<th colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style>36 Month Trial duration, 2.5% One-sided Type 1 Error, 90% Power</th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Time</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">N</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Events</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">AHR</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Scenario</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_right">36</td>
<td class="gt_row gt_right">563</td>
<td class="gt_row gt_right">332</td>
<td class="gt_row gt_right">0.700</td>
<td class="gt_row gt_left">PH</td>
</tr>
<tr>
<td class="gt_row gt_right">36</td>
<td class="gt_row gt_right">547</td>
<td class="gt_row gt_right">365</td>
<td class="gt_row gt_right">0.711</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">36</td>
<td class="gt_row gt_right">1,338</td>
<td class="gt_row gt_right">993</td>
<td class="gt_row gt_right">0.814</td>
<td class="gt_row gt_left">Delayed effect 2</td>
</tr>
<tr>
<td class="gt_row gt_right">36</td>
<td class="gt_row gt_right">1,846</td>
<td class="gt_row gt_right">1,360</td>
<td class="gt_row gt_right">0.838</td>
<td class="gt_row gt_left">Crossing</td>
</tr>
</tbody>
</table>
</div>
<p>Assuming delayed effect 1 is the primary scenario for which we wish to protect power, how long should the trial be to optimize the tradeoffs between sample size, AHR and events required? We will inform this tradeoff by looking sizing the trial for different assumed trial durations with the same failure rates and assumed relative enrollment rates. The counts of events required is perhaps the most interesting here in that a 24 month trial requires almost twice the events to be powered at 90% compared to a trial of 42 months duration. For further study, we will consider the 36 month trial duration as a reasonable tradeoff between time, sample size and power under a presumed delayed effect of 4 months followed by a hazard ratio of 0.6 thereafter.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ss_ahr_fixed</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">g</span> <span class="op">&lt;-</span> <span class="st">"Delayed effect 1"</span>
<span class="kw">for</span><span class="op">(</span><span class="va">trialEnd</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">24</span>,<span class="fl">30</span>,<span class="fl">36</span>,<span class="fl">42</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">ss_ahr_fixed</span> <span class="op">&lt;-</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ss_ahr_fixed</span>,
      <span class="fu"><a href="../reference/gs_design_ahr.html">gs_design_ahr</a></span><span class="op">(</span>enrollRates <span class="op">=</span> <span class="va">enrollRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Scenario</span> <span class="op">==</span> <span class="va">g</span><span class="op">)</span>,
                    failRates <span class="op">=</span> <span class="va">failRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Scenario</span> <span class="op">==</span> <span class="va">g</span><span class="op">)</span>,
                    analysisTimes <span class="op">=</span> <span class="va">trialEnd</span>,
                    upper <span class="op">=</span> <span class="va">gs_b</span>, upar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">.975</span><span class="op">)</span>,
                    lower <span class="op">=</span> <span class="va">gs_b</span>, lpar <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,
                    alpha <span class="op">=</span> <span class="fl">.025</span>,
                    beta <span class="op">=</span> <span class="fl">.1</span>
                    <span class="op">)</span><span class="op">$</span><span class="va">bounds</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="va">g</span><span class="op">)</span>
      <span class="op">)</span>
<span class="op">}</span>
<span class="va">ss_ahr_fixed</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">N</span>, <span class="va">Events</span>, <span class="va">AHR</span>, <span class="va">Scenario</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>columns<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,decimals <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fl">4</span>, decimals <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_header.html">tab_header</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sample Size and Events Required by Trial Duration"</span>,
             subtitle <span class="op">=</span> <span class="st">"Delayed Effect of 4 Months, HR = 0.6 Thereafter; 90% Power"</span><span class="op">)</span></code></pre></div>
<div id="yxuhvghyad" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#yxuhvghyad .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yxuhvghyad .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yxuhvghyad .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yxuhvghyad .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yxuhvghyad .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yxuhvghyad .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yxuhvghyad .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yxuhvghyad .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yxuhvghyad .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yxuhvghyad .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yxuhvghyad .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yxuhvghyad .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#yxuhvghyad .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yxuhvghyad .gt_from_md > :first-child {
  margin-top: 0;
}

#yxuhvghyad .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yxuhvghyad .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yxuhvghyad .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#yxuhvghyad .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yxuhvghyad .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#yxuhvghyad .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yxuhvghyad .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yxuhvghyad .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yxuhvghyad .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yxuhvghyad .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yxuhvghyad .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#yxuhvghyad .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yxuhvghyad .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#yxuhvghyad .gt_left {
  text-align: left;
}

#yxuhvghyad .gt_center {
  text-align: center;
}

#yxuhvghyad .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yxuhvghyad .gt_font_normal {
  font-weight: normal;
}

#yxuhvghyad .gt_font_bold {
  font-weight: bold;
}

#yxuhvghyad .gt_font_italic {
  font-style: italic;
}

#yxuhvghyad .gt_super {
  font-size: 65%;
}

#yxuhvghyad .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="table gt_table">
<thead class="gt_header">
<tr>
<th colspan="5" class="gt_heading gt_title gt_font_normal" style>Sample Size and Events Required by Trial Duration</th>
    </tr>
<tr>
<th colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style>Delayed Effect of 4 Months, HR = 0.6 Thereafter; 90% Power</th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Time</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">N</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Events</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">AHR</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Scenario</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_right">24</td>
<td class="gt_row gt_right">1,582</td>
<td class="gt_row gt_right">643</td>
<td class="gt_row gt_right">0.774</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">30</td>
<td class="gt_row gt_right">801</td>
<td class="gt_row gt_right">448</td>
<td class="gt_row gt_right">0.735</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">36</td>
<td class="gt_row gt_right">547</td>
<td class="gt_row gt_right">365</td>
<td class="gt_row gt_right">0.711</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">42</td>
<td class="gt_row gt_right">441</td>
<td class="gt_row gt_right">329</td>
<td class="gt_row gt_right">0.699</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="alternate-hypothesis-mapping" class="section level3">
<h3 class="hasAnchor">
<a href="#alternate-hypothesis-mapping" class="anchor"></a>Alternate hypothesis mapping</h3>
<p>Experimental version of <code><a href="https://merck.github.io/gsDesign2/reference/AHR.html">AHR()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">AHRx</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">enrollRates</span><span class="op">=</span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>Stratum<span class="op">=</span><span class="st">"All"</span>,
                                           duration<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">10</span><span class="op">)</span>,
                                           rate<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">6</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span>,
                <span class="va">failRates</span><span class="op">=</span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>Stratum<span class="op">=</span><span class="st">"All"</span>,
                                         duration<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">100</span><span class="op">)</span>,
                                         failRate<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9</span>,<span class="fl">18</span><span class="op">)</span>,
                                         hr<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.9</span>,<span class="fl">.6</span><span class="op">)</span>,
                                         dropoutRate<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">.001</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
                <span class="va">totalDuration</span><span class="op">=</span><span class="fl">30</span>,
                <span class="va">ratio</span><span class="op">=</span><span class="fl">1</span>,
                <span class="va">simple</span><span class="op">=</span><span class="cn">TRUE</span>
<span class="op">)</span><span class="op">{</span>
  <span class="co"># check input values</span>
  <span class="co"># check input enrollment rate assumptions</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">enrollRates</span><span class="op">)</span><span class="op">==</span><span class="st">"Stratum"</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"gsDesign2: enrollRates column names in `AHR()` must contain stratum"</span><span class="op">)</span><span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">enrollRates</span><span class="op">)</span><span class="op">==</span><span class="st">"duration"</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"gsDesign2: enrollRates column names in `AHR()` must contain duration"</span><span class="op">)</span><span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">enrollRates</span><span class="op">)</span><span class="op">==</span><span class="st">"rate"</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"gsDesign2: enrollRates column names in `AHR()' must contain rate"</span><span class="op">)</span><span class="op">}</span>

  <span class="co"># check input failure rate assumptions</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">failRates</span><span class="op">)</span><span class="op">==</span><span class="st">"Stratum"</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"gsDesign2: failRates column names in `AHR()` must contain stratum"</span><span class="op">)</span><span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">failRates</span><span class="op">)</span><span class="op">==</span><span class="st">"duration"</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"gsDesign2: failRates column names in `AHR()` must contain duration"</span><span class="op">)</span><span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">failRates</span><span class="op">)</span><span class="op">==</span><span class="st">"failRate"</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"gsDesign2: failRates column names in `AHR()` must contain failRate"</span><span class="op">)</span><span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">failRates</span><span class="op">)</span><span class="op">==</span><span class="st">"hr"</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"gsDesign2: failRates column names in `AHR()` must contain hr"</span><span class="op">)</span><span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">failRates</span><span class="op">)</span><span class="op">==</span><span class="st">"dropoutRate"</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"gsDesign2: failRates column names in `AHR()` must contain dropoutRate"</span><span class="op">)</span><span class="op">}</span>

  <span class="co"># check input trial durations</span>
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">totalDuration</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"gsDesign2: totalDuration in `AHR()` must be a non-empty vector of positive numbers"</span><span class="op">)</span><span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">is.vector</a></span><span class="op">(</span><span class="va">totalDuration</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"gsDesign2: totalDuration in `AHR()` must be a non-empty vector of positive numbers"</span><span class="op">)</span><span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">totalDuration</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"gsDesign2: totalDuration in `AHR()` must be greater than zero"</span><span class="op">)</span><span class="op">}</span>
  <span class="va">strata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">enrollRates</span><span class="op">$</span><span class="va">Stratum</span><span class="op">)</span><span class="op">)</span>
  <span class="va">strata2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">failRates</span><span class="op">$</span><span class="va">Stratum</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">strata</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">strata2</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="va">strata</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">strata2</span><span class="op">==</span><span class="va">s</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"gsDesign2: Strata in `AHR()` must be the same in enrollRates and failRates"</span><span class="op">)</span><span class="op">}</span>
  <span class="op">}</span>
  <span class="co"># check input simple is logical</span>
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html">is.logical</a></span><span class="op">(</span><span class="va">simple</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"gsDesign2: simple in `AHR()` must be logical"</span><span class="op">)</span><span class="op">}</span>

  <span class="co"># compute proportion in each group</span>
  <span class="va">Qe</span> <span class="op">&lt;-</span> <span class="va">ratio</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">ratio</span><span class="op">)</span>
  <span class="va">Qc</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">Qe</span>

  <span class="co"># compute expected events by treatment group, stratum and time period</span>
  <span class="va">rval</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">td</span> <span class="kw">in</span> <span class="va">totalDuration</span><span class="op">)</span><span class="op">{</span>
    <span class="va">events</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="va">strata</span><span class="op">)</span><span class="op">{</span>
      <span class="co"># subset to stratum</span>
      <span class="va">enroll</span> <span class="op">&lt;-</span> <span class="va">enrollRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Stratum</span><span class="op">==</span><span class="va">s</span><span class="op">)</span>
      <span class="va">fail</span> <span class="op">&lt;-</span> <span class="va">failRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Stratum</span><span class="op">==</span><span class="va">s</span><span class="op">)</span>
      <span class="co"># Control events</span>
      <span class="va">enrollc</span> <span class="op">&lt;-</span> <span class="va">enroll</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rate<span class="op">=</span><span class="va">rate</span><span class="op">*</span><span class="va">Qc</span><span class="op">)</span>
      <span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://merck.github.io/gsDesign2/reference/eEvents_df.html">eEvents_df</a></span><span class="op">(</span>enrollRates<span class="op">=</span><span class="va">enrollc</span>,failRates<span class="op">=</span><span class="va">fail</span>,totalDuration<span class="op">=</span><span class="va">td</span>,simple<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
      <span class="co"># Experimental events</span>
      <span class="va">enrolle</span> <span class="op">&lt;-</span> <span class="va">enroll</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rate<span class="op">=</span><span class="va">rate</span><span class="op">*</span><span class="va">Qe</span><span class="op">)</span>
      <span class="va">fre</span> <span class="op">&lt;-</span> <span class="va">fail</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>failRate<span class="op">=</span><span class="va">failRate</span><span class="op">*</span><span class="va">hr</span><span class="op">)</span>
      <span class="va">experimental</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://merck.github.io/gsDesign2/reference/eEvents_df.html">eEvents_df</a></span><span class="op">(</span>enrollRates<span class="op">=</span><span class="va">enrolle</span>,failRates<span class="op">=</span><span class="va">fre</span>,totalDuration<span class="op">=</span><span class="va">td</span>,simple<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
      <span class="co"># Combine control and experimental; by period recompute HR, events, information</span>
      <span class="va">events</span> <span class="op">&lt;-</span>
        <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">control</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Treatment<span class="op">=</span><span class="st">"Control"</span><span class="op">)</span>,
              <span class="va">experimental</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Treatment<span class="op">=</span><span class="st">"Experimental"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">Treatment</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>Stratum <span class="op">=</span> <span class="va">s</span>, info <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">Events</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,
                  Events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Events</span><span class="op">)</span>, HR <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="va">failRate</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">failRate</span><span class="op">)</span>
        <span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">events</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="va">rval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">rval</span>,
                  <span class="va">events</span> <span class="op">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Time<span class="op">=</span><span class="va">td</span>, lnhr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">HR</span><span class="op">)</span>, info0 <span class="op">=</span> <span class="va">Events</span> <span class="op">*</span> <span class="va">Qc</span> <span class="op">*</span> <span class="va">Qe</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="co"># NEXT 2 lines are the only changes from AHR()</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Stratum</span>, <span class="va">t</span><span class="op">)</span> <span class="op">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>Time <span class="op">=</span> <span class="va">td</span>, Events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Events</span><span class="op">)</span>, HR<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">HR</span><span class="op">)</span>, lnhr<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">lnhr</span><span class="op">)</span>, info0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">info0</span><span class="op">)</span>, info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">info</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span>

  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">simple</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">rval</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Time"</span>, <span class="st">"Stratum"</span>, <span class="st">"t"</span>, <span class="st">"HR"</span>, <span class="st">"Events"</span>, <span class="st">"info"</span>, <span class="st">"info0"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Stratum</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">t</span>, .by_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">rval</span> <span class="op">%&gt;%</span>
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Time</span><span class="op">)</span> <span class="op">%&gt;%</span>
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>AHR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">HR</span><span class="op">)</span><span class="op">*</span><span class="va">Events</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Events</span><span class="op">)</span><span class="op">)</span>,
                     Events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Events</span><span class="op">)</span>,
                     info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">info</span><span class="op">)</span>,
                     info0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">info0</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Under the different scenarios of interest, we can examine the expected number of events in time periods of interest.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">events_by_time_period</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="kw">for</span><span class="op">(</span><span class="va">g</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PH"</span>, <span class="st">"Delayed effect 1"</span>,<span class="st">"Delayed effect 2"</span>, <span class="st">"Crossing"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">events_by_time_period</span> <span class="op">&lt;-</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">events_by_time_period</span>,
      <span class="fu">AHRx</span><span class="op">(</span>enrollRates <span class="op">=</span> <span class="va">enrollRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Scenario</span> <span class="op">==</span> <span class="va">g</span><span class="op">)</span>,
          failRates <span class="op">=</span> <span class="va">failRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Scenario</span> <span class="op">==</span> <span class="va">g</span><span class="op">)</span>,
          totalDuration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">20</span>, <span class="fl">28</span>, <span class="fl">36</span><span class="op">)</span>, simple <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="va">g</span><span class="op">)</span>
      <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'Stratum'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">events_by_time_period</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div id="rpoxygpkfh" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#rpoxygpkfh .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rpoxygpkfh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rpoxygpkfh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rpoxygpkfh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rpoxygpkfh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rpoxygpkfh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rpoxygpkfh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rpoxygpkfh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rpoxygpkfh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rpoxygpkfh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rpoxygpkfh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rpoxygpkfh .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#rpoxygpkfh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rpoxygpkfh .gt_from_md > :first-child {
  margin-top: 0;
}

#rpoxygpkfh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rpoxygpkfh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rpoxygpkfh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#rpoxygpkfh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rpoxygpkfh .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#rpoxygpkfh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rpoxygpkfh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rpoxygpkfh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rpoxygpkfh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rpoxygpkfh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rpoxygpkfh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#rpoxygpkfh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rpoxygpkfh .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#rpoxygpkfh .gt_left {
  text-align: left;
}

#rpoxygpkfh .gt_center {
  text-align: center;
}

#rpoxygpkfh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rpoxygpkfh .gt_font_normal {
  font-weight: normal;
}

#rpoxygpkfh .gt_font_bold {
  font-weight: bold;
}

#rpoxygpkfh .gt_font_italic {
  font-style: italic;
}

#rpoxygpkfh .gt_super {
  font-size: 65%;
}

#rpoxygpkfh .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="table gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">t</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">HR</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Events</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">info</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">info0</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Scenario</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row">
<td colspan="6" class="gt_group_heading">12 - All</td>
    </tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">5.1852619</td>
<td class="gt_row gt_right">1.2615254</td>
<td class="gt_row gt_right">1.2963155</td>
<td class="gt_row gt_left">PH</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">1.2900768</td>
<td class="gt_row gt_right">0.3161088</td>
<td class="gt_row gt_right">0.3225192</td>
<td class="gt_row gt_left">PH</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">0.9992867</td>
<td class="gt_row gt_right">0.2461646</td>
<td class="gt_row gt_right">0.2498217</td>
<td class="gt_row gt_left">PH</td>
</tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1.0</td>
<td class="gt_row gt_right">7.5026311</td>
<td class="gt_row gt_right">1.8756578</td>
<td class="gt_row gt_right">1.8756578</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">1.4148718</td>
<td class="gt_row gt_right">0.3334561</td>
<td class="gt_row gt_right">0.3537179</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">1.0660140</td>
<td class="gt_row gt_right">0.2551204</td>
<td class="gt_row gt_right">0.2665035</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1.0</td>
<td class="gt_row gt_right">10.5036835</td>
<td class="gt_row gt_right">2.6259209</td>
<td class="gt_row gt_right">2.6259209</td>
<td class="gt_row gt_left">Delayed effect 2</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">1.0</td>
<td class="gt_row gt_right">2.4549051</td>
<td class="gt_row gt_right">0.6137263</td>
<td class="gt_row gt_right">0.6137263</td>
<td class="gt_row gt_left">Delayed effect 2</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">1.5503657</td>
<td class="gt_row gt_right">0.3774733</td>
<td class="gt_row gt_right">0.3875914</td>
<td class="gt_row gt_left">Delayed effect 2</td>
</tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1.5</td>
<td class="gt_row gt_right">12.7170764</td>
<td class="gt_row gt_right">3.0829595</td>
<td class="gt_row gt_right">3.1792691</td>
<td class="gt_row gt_left">Crossing</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">1.8916151</td>
<td class="gt_row gt_right">0.4309693</td>
<td class="gt_row gt_right">0.4729038</td>
<td class="gt_row gt_left">Crossing</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">1.4223228</td>
<td class="gt_row gt_right">0.3303949</td>
<td class="gt_row gt_right">0.3555807</td>
<td class="gt_row gt_left">Crossing</td>
</tr>
<tr class="gt_group_heading_row">
<td colspan="6" class="gt_group_heading">20 - All</td>
    </tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">11.0617281</td>
<td class="gt_row gt_right">2.6918692</td>
<td class="gt_row gt_right">2.7654320</td>
<td class="gt_row gt_left">PH</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">3.8607787</td>
<td class="gt_row gt_right">0.9461198</td>
<td class="gt_row gt_right">0.9651947</td>
<td class="gt_row gt_left">PH</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">8.2028185</td>
<td class="gt_row gt_right">2.0274071</td>
<td class="gt_row gt_right">2.0507046</td>
<td class="gt_row gt_left">PH</td>
</tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1.0</td>
<td class="gt_row gt_right">15.9738890</td>
<td class="gt_row gt_right">3.9934723</td>
<td class="gt_row gt_right">3.9934723</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">4.2318445</td>
<td class="gt_row gt_right">0.9976903</td>
<td class="gt_row gt_right">1.0579611</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">8.5867796</td>
<td class="gt_row gt_right">2.0744467</td>
<td class="gt_row gt_right">2.1466949</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1.0</td>
<td class="gt_row gt_right">21.5580025</td>
<td class="gt_row gt_right">5.3895006</td>
<td class="gt_row gt_right">5.3895006</td>
<td class="gt_row gt_left">Delayed effect 2</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">1.0</td>
<td class="gt_row gt_right">7.3386703</td>
<td class="gt_row gt_right">1.8346676</td>
<td class="gt_row gt_right">1.8346676</td>
<td class="gt_row gt_left">Delayed effect 2</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">12.4353719</td>
<td class="gt_row gt_right">3.0443187</td>
<td class="gt_row gt_right">3.1088430</td>
<td class="gt_row gt_left">Delayed effect 2</td>
</tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1.5</td>
<td class="gt_row gt_right">26.0319889</td>
<td class="gt_row gt_right">6.3157669</td>
<td class="gt_row gt_right">6.5079972</td>
<td class="gt_row gt_left">Crossing</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">5.6575413</td>
<td class="gt_row gt_right">1.2894992</td>
<td class="gt_row gt_right">1.4143853</td>
<td class="gt_row gt_left">Crossing</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">11.4403357</td>
<td class="gt_row gt_right">2.6904019</td>
<td class="gt_row gt_right">2.8600839</td>
<td class="gt_row gt_left">Crossing</td>
</tr>
<tr class="gt_group_heading_row">
<td colspan="6" class="gt_group_heading">28 - All</td>
    </tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">15.4257237</td>
<td class="gt_row gt_right">3.7546492</td>
<td class="gt_row gt_right">3.8564309</td>
<td class="gt_row gt_left">PH</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">6.4314807</td>
<td class="gt_row gt_right">1.5761307</td>
<td class="gt_row gt_right">1.6078702</td>
<td class="gt_row gt_left">PH</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">21.5768513</td>
<td class="gt_row gt_right">5.3488075</td>
<td class="gt_row gt_right">5.3942128</td>
<td class="gt_row gt_left">PH</td>
</tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1.0</td>
<td class="gt_row gt_right">22.2370521</td>
<td class="gt_row gt_right">5.5592630</td>
<td class="gt_row gt_right">5.5592630</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">7.0488173</td>
<td class="gt_row gt_right">1.6619243</td>
<td class="gt_row gt_right">1.7622043</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">22.1716513</td>
<td class="gt_row gt_right">5.4012239</td>
<td class="gt_row gt_right">5.5429128</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1.0</td>
<td class="gt_row gt_right">22.2370521</td>
<td class="gt_row gt_right">5.5592630</td>
<td class="gt_row gt_right">5.5592630</td>
<td class="gt_row gt_left">Delayed effect 2</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">1.0</td>
<td class="gt_row gt_right">9.1570597</td>
<td class="gt_row gt_right">2.2892649</td>
<td class="gt_row gt_right">2.2892649</td>
<td class="gt_row gt_left">Delayed effect 2</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">30.1523434</td>
<td class="gt_row gt_right">7.4217817</td>
<td class="gt_row gt_right">7.5380859</td>
<td class="gt_row gt_left">Delayed effect 2</td>
</tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1.5</td>
<td class="gt_row gt_right">26.8302861</td>
<td class="gt_row gt_right">6.5109859</td>
<td class="gt_row gt_right">6.7075715</td>
<td class="gt_row gt_left">Crossing</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">7.0611116</td>
<td class="gt_row gt_right">1.6097430</td>
<td class="gt_row gt_right">1.7652779</td>
<td class="gt_row gt_left">Crossing</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">27.8387318</td>
<td class="gt_row gt_right">6.6300112</td>
<td class="gt_row gt_right">6.9596830</td>
<td class="gt_row gt_left">Crossing</td>
</tr>
<tr class="gt_group_heading_row">
<td colspan="6" class="gt_group_heading">36 - All</td>
    </tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">15.4257237</td>
<td class="gt_row gt_right">3.7546492</td>
<td class="gt_row gt_right">3.8564309</td>
<td class="gt_row gt_left">PH</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">6.7480926</td>
<td class="gt_row gt_right">1.6537787</td>
<td class="gt_row gt_right">1.6870231</td>
<td class="gt_row gt_left">PH</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">36.7770862</td>
<td class="gt_row gt_right">9.1420106</td>
<td class="gt_row gt_right">9.1942716</td>
<td class="gt_row gt_left">PH</td>
</tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1.0</td>
<td class="gt_row gt_right">22.2370521</td>
<td class="gt_row gt_right">5.5592630</td>
<td class="gt_row gt_right">5.5592630</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">7.3945534</td>
<td class="gt_row gt_right">1.7436142</td>
<td class="gt_row gt_right">1.8486384</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">37.0547447</td>
<td class="gt_row gt_right">9.0971239</td>
<td class="gt_row gt_right">9.2636862</td>
<td class="gt_row gt_left">Delayed effect 1</td>
</tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1.0</td>
<td class="gt_row gt_right">22.2370521</td>
<td class="gt_row gt_right">5.5592630</td>
<td class="gt_row gt_right">5.5592630</td>
<td class="gt_row gt_left">Delayed effect 2</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">1.0</td>
<td class="gt_row gt_right">9.1570597</td>
<td class="gt_row gt_right">2.2892649</td>
<td class="gt_row gt_right">2.2892649</td>
<td class="gt_row gt_left">Delayed effect 2</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.7</td>
<td class="gt_row gt_right">42.8818670</td>
<td class="gt_row gt_right">10.6126866</td>
<td class="gt_row gt_right">10.7204667</td>
<td class="gt_row gt_left">Delayed effect 2</td>
</tr>
<tr>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">1.5</td>
<td class="gt_row gt_right">26.8302861</td>
<td class="gt_row gt_right">6.5109859</td>
<td class="gt_row gt_right">6.7075715</td>
<td class="gt_row gt_left">Crossing</td>
</tr>
<tr>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">7.0611116</td>
<td class="gt_row gt_right">1.6097430</td>
<td class="gt_row gt_right">1.7652779</td>
<td class="gt_row gt_left">Crossing</td>
</tr>
<tr>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">0.6</td>
<td class="gt_row gt_right">39.7839241</td>
<td class="gt_row gt_right">9.6020931</td>
<td class="gt_row gt_right">9.9459810</td>
<td class="gt_row gt_left">Crossing</td>
</tr>
</tbody>
</table>
</div>
<p>Recall that our alternate hypothesis assumes no treatment effect (HR=1) for 4 months and then HR = 0.6 thereafter. For any of the above scenarios, if we wish to base a futility bound on this assumption plus the above number of events in the first 4 months and after 4 months, then we can compute the average hazard ratio under the alternate hazard ratio for each scenario at 20 months as follows. You can see that an interim futility spending bound based on the alternate hypothesis can depend fairly heavily on enrollment and the control failure rate. Note also that at the time of interim analysis, the alternate hypothesis AHR can be computed in this same fashion based on observed events by time period. Note that this can be quite different than the scenario HR; e.g., for PH, we assume HR=0.7 throughout, but for the futility bound comparison, we compute blinded AHR that decreases with each analysis under the alternate hypothesis.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Time periods for each scenario were 0-4, 4-6, and 6+</span>
<span class="co"># Thus H1 has HR as follows</span>
<span class="va">hr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span>, hr1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.6</span>, <span class="fl">.6</span><span class="op">)</span><span class="op">)</span>
<span class="va">ahr_by_analysis</span> <span class="op">&lt;-</span>
  <span class="va">events_by_time_period</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">hr1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Scenario</span>, <span class="va">Time</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>AHR1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Events</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">hr1</span><span class="op">)</span><span class="op">)</span><span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Events</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Joining, by = "t"</code></pre>
<pre><code>## `summarise()` has grouped output by 'Scenario'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ahr_by_analysis</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">Scenario</span>, values_from <span class="op">=</span> <span class="va">AHR1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html">fmt_number</a></span><span class="op">(</span>columns<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span>, decimals <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div id="tnyflssbkj" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#tnyflssbkj .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tnyflssbkj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tnyflssbkj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#tnyflssbkj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#tnyflssbkj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tnyflssbkj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tnyflssbkj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tnyflssbkj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tnyflssbkj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tnyflssbkj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tnyflssbkj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tnyflssbkj .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#tnyflssbkj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tnyflssbkj .gt_from_md > :first-child {
  margin-top: 0;
}

#tnyflssbkj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tnyflssbkj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tnyflssbkj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#tnyflssbkj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tnyflssbkj .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#tnyflssbkj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tnyflssbkj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tnyflssbkj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tnyflssbkj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tnyflssbkj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tnyflssbkj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#tnyflssbkj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tnyflssbkj .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#tnyflssbkj .gt_left {
  text-align: left;
}

#tnyflssbkj .gt_center {
  text-align: center;
}

#tnyflssbkj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tnyflssbkj .gt_font_normal {
  font-weight: normal;
}

#tnyflssbkj .gt_font_bold {
  font-weight: bold;
}

#tnyflssbkj .gt_font_italic {
  font-style: italic;
}

#tnyflssbkj .gt_super {
  font-size: 65%;
}

#tnyflssbkj .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="table gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Time</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Crossing</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Delayed effect 1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Delayed effect 2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">PH</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_right">12</td>
<td class="gt_row gt_right">0.900</td>
<td class="gt_row gt_right">0.881</td>
<td class="gt_row gt_right">0.868</td>
<td class="gt_row gt_right">0.855</td>
</tr>
<tr>
<td class="gt_row gt_right">20</td>
<td class="gt_row gt_right">0.817</td>
<td class="gt_row gt_right">0.797</td>
<td class="gt_row gt_right">0.783</td>
<td class="gt_row gt_right">0.766</td>
</tr>
<tr>
<td class="gt_row gt_right">28</td>
<td class="gt_row gt_right">0.749</td>
<td class="gt_row gt_right">0.748</td>
<td class="gt_row gt_right">0.722</td>
<td class="gt_row gt_right">0.719</td>
</tr>
<tr>
<td class="gt_row gt_right">36</td>
<td class="gt_row gt_right">0.723</td>
<td class="gt_row gt_right">0.711</td>
<td class="gt_row gt_right">0.699</td>
<td class="gt_row gt_right">0.686</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="group-sequential-design" class="section level2">
<h2 class="hasAnchor">
<a href="#group-sequential-design" class="anchor"></a>Group sequential design</h2>
<p>Here we assume the design is under a delayed effect model where the delay is not too long and the long-term average hazard ratio benefit is strong. proportional hazards scenario, but we look at power under the alternate scenarios. We will plan a 36 month group sequential design under the delayed effect 1 scenario. Interim analyses are planned after 12, 20, and 28 months.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">analysisTimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">20</span>, <span class="fl">28</span>, <span class="fl">36</span><span class="op">)</span>
<span class="va">upar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sf <span class="op">=</span> <span class="fu">gsDesign</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/gsDesign/man/sfLDOF.html">sfLDOF</a></span>, total_spend <span class="op">=</span> <span class="fl">0.025</span>, param <span class="op">=</span> <span class="cn">NULL</span>, timing <span class="op">=</span> <span class="cn">NULL</span>, theta<span class="op">=</span><span class="fl">0</span><span class="op">)</span>
<span class="va">lpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sf <span class="op">=</span> <span class="fu">gsDesign</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/gsDesign/man/sfHSD.html">sfHSD</a></span>, total_spend <span class="op">=</span> <span class="fl">.1</span>, param <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, timing <span class="op">=</span> <span class="cn">NULL</span>, theta<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span>
<span class="va">NPHasymmetric</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gs_design_ahr.html">gs_design_ahr</a></span><span class="op">(</span>enrollRates <span class="op">=</span> <span class="va">enrollRates</span>,
                               failRates <span class="op">=</span> <span class="va">failRates</span>,
                               ratio <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">.025</span>, beta <span class="op">=</span> <span class="fl">0.1</span>,
                               <span class="co"># Information fraction not required (but available!)</span>
                               analysisTimes <span class="op">=</span> <span class="va">analysisTimes</span>,
                               <span class="co"># Function to enable spending bound</span>
                               upper <span class="op">=</span> <span class="va">gs_spending_bound</span>, lower <span class="op">=</span> <span class="va">gs_spending_bound</span>,
                               <span class="co"># Spending function and parameters used</span>
                               upar <span class="op">=</span> <span class="va">upar</span>, lpar <span class="op">=</span> <span class="va">lpar</span>
<span class="op">)</span>
<span class="va">NPHasymmetric</span><span class="op">$</span><span class="va">bounds</span></code></pre></div>
<pre><code>## # A tibble: 8 Ã— 11
##   Analysis Bound  Time     N Events      Z  Probability   AHR theta  info info0
##      &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1        1 Upper    12  231.   40.3  6.58  0.0000000236   0.7 0.357  9.82  10.1
## 2        2 Upper    20  436.  125.   3.62  0.0492         0.7 0.357 30.5   31.1
## 3        3 Upper    28  577.  236.   2.52  0.577          0.7 0.357 58.1   59.1
## 4        4 Upper    36  769.  358.   1.99  0.900          0.7 0.357 88.2   89.4
## 5        1 Lower    12  231.   40.3 -1.54  0.00391        0.7 0.357  9.82  10.1
## 6        2 Lower    20  436.  125.  -0.265 0.0156         0.7 0.357 30.5   31.1
## 7        3 Lower    28  577.  236.   0.899 0.0429         0.7 0.357 58.1   59.1
## 8        4 Lower    36  769.  358.   1.99  0.100          0.7 0.357 88.2   89.4</code></pre>
<p>By scenario, we now wish to compute the adjusted expected futility bounds and the power implied.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xx</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">lparx</span> <span class="op">&lt;-</span> <span class="va">lpar</span>
<span class="kw">for</span><span class="op">(</span><span class="va">g</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PH"</span>, <span class="st">"Delayed effect 1"</span>,<span class="st">"Delayed effect 2"</span>, <span class="st">"Crossing"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">AHR1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ahr_by_analysis</span>, <span class="va">Scenario</span> <span class="op">==</span> <span class="va">g</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">AHR1</span>
  <span class="va">lparx</span><span class="op">$</span><span class="va">theta1</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">AHR1</span><span class="op">)</span>
  <span class="va">yy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gs_power_ahr.html">gs_power_ahr</a></span><span class="op">(</span>enrollRates <span class="op">=</span> <span class="va">enrollRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Scenario</span> <span class="op">==</span> <span class="va">g</span><span class="op">)</span>,
               failRates <span class="op">=</span> <span class="va">failRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Scenario</span> <span class="op">==</span> <span class="va">g</span><span class="op">)</span>, 
               events <span class="op">=</span> <span class="cn">NULL</span>,
               analysisTimes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">12</span>,<span class="fl">20</span>,<span class="fl">28</span>,<span class="fl">36</span><span class="op">)</span>,
               upper <span class="op">=</span> <span class="va">gs_spending_bound</span>,
               upar <span class="op">=</span> <span class="va">upar</span>,
               lower <span class="op">=</span> <span class="va">gs_spending_bound</span>,
               lpar <span class="op">=</span> <span class="va">lparx</span><span class="op">)</span>
  <span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">xx</span>, <span class="va">yy</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="va">g</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div id="weighted-logrank" class="section level3">
<h3 class="hasAnchor">
<a href="#weighted-logrank" class="anchor"></a>Weighted logrank</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ss_FH05_fixed</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">g</span> <span class="op">&lt;-</span> <span class="st">"Delayed effect"</span>
<span class="co"># for(g in c("PH", "Delayed effect", "Crossing")){</span>
<span class="co">#     ss_FH05_fixed &lt;- </span>
<span class="co">#       rbind(ss_FH05_fixed,</span>
    <span class="va">gs_arm</span> <span class="op">&lt;-</span> <span class="fu">gsdmvn</span><span class="fu">:::</span><span class="fu"><a href="../reference/gs_create_arm.html">gs_create_arm</a></span><span class="op">(</span><span class="va">enrollRates</span>, <span class="va">failRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Scenario</span> <span class="op">==</span> <span class="va">g</span><span class="op">)</span>, 
                                     ratio <span class="op">=</span> <span class="fl">1</span>,       <span class="co"># Randomization ratio</span>
                                     total_time <span class="op">=</span> <span class="fl">44</span><span class="op">)</span> <span class="co"># Total study duration</span>
    <span class="va">arm0</span> <span class="op">&lt;-</span> <span class="va">gs_arm</span><span class="op">[[</span><span class="st">"arm0"</span><span class="op">]</span><span class="op">]</span>
    <span class="va">arm1</span> <span class="op">&lt;-</span> <span class="va">gs_arm</span><span class="op">[[</span><span class="st">"arm1"</span><span class="op">]</span><span class="op">]</span>
    <span class="fu">npsurvSS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/npsurvSS/man/size_two_arm.html">size_two_arm</a></span><span class="op">(</span><span class="va">arm0</span>, <span class="va">arm1</span>, power <span class="op">=</span> <span class="fl">0.9</span>, alpha <span class="op">=</span> <span class="fl">0.025</span>, 
                           test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>test<span class="op">=</span><span class="st">"weighted logrank"</span>, weight <span class="op">=</span> <span class="st">"FH_p.5_q0"</span><span class="op">)</span><span class="op">)</span>
    
    <span class="fu">npsurvSS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/npsurvSS/man/size_two_arm.html">size_two_arm</a></span><span class="op">(</span><span class="va">arm0</span>, <span class="va">arm1</span>, power <span class="op">=</span> <span class="fl">0.9</span>, alpha <span class="op">=</span> <span class="fl">0.025</span>, 
                       test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>test<span class="op">=</span><span class="st">"rmst difference"</span>, 
                       <span class="co"># Milestone allow user to define RMST cutpoint</span>
                       milestone <span class="op">=</span> <span class="fl">44</span><span class="op">)</span><span class="op">)</span> <span class="co"># 42 selected since better than 40 or 44</span>
    <span class="fu">gsdmvn</span><span class="fu">:::</span><span class="fu"><a href="../reference/gs_design_wlr.html">gs_design_wlr</a></span><span class="op">(</span>enrollRates <span class="op">=</span> <span class="va">enrollRates</span>, 
                           failRates <span class="op">=</span> <span class="va">failRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Scenario</span> <span class="op">==</span> <span class="va">g</span><span class="op">)</span>, 
                           weight <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">arm0</span>, <span class="va">arm1</span><span class="op">)</span><span class="op">{</span>
                                      <span class="fu">gsdmvn</span><span class="fu">:::</span><span class="fu"><a href="../reference/wlr_weight.html">wlr_weight_fh</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">arm0</span>, <span class="va">arm1</span>, 
                                                             rho <span class="op">=</span> <span class="fl">0</span>, gamma <span class="op">=</span> <span class="fl">0.5</span>, tau <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">}</span>,
                           alpha <span class="op">=</span> <span class="fl">.025</span>, beta <span class="op">=</span> <span class="fl">.1</span>,
                           upar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">.975</span><span class="op">)</span>,
                           lpar <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,
                           analysisTimes <span class="op">=</span> <span class="fl">44</span><span class="op">)</span><span class="op">$</span><span class="va">bounds</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Bound</span> <span class="op">==</span><span class="st">"Upper"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ignore tau or (tau can be -1) </span>
<span class="fu">gsdmvn</span><span class="fu">:::</span><span class="fu"><a href="../reference/gs_design_wlr.html">gs_design_wlr</a></span><span class="op">(</span>enrollRates <span class="op">=</span> <span class="va">enrollRates</span>, 
                       failRates <span class="op">=</span> <span class="va">failRates</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Scenario</span> <span class="op">==</span> <span class="va">g</span><span class="op">)</span>, 
                       weight <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">arm0</span>, <span class="va">arm1</span><span class="op">)</span><span class="op">{</span>
                                  <span class="fu">gsdmvn</span><span class="fu">:::</span><span class="fu"><a href="../reference/wlr_weight.html">wlr_weight_fh</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">arm0</span>, <span class="va">arm1</span>, 
                                                         rho <span class="op">=</span> <span class="fl">0</span>, gamma <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">}</span>,
                       alpha <span class="op">=</span> <span class="fl">.025</span>, beta <span class="op">=</span> <span class="fl">.1</span>,
                       upar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">.975</span><span class="op">)</span>,
                       lpar <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,
                       analysisTimes <span class="op">=</span> <span class="fl">44</span><span class="op">)</span><span class="op">$</span><span class="va">bounds</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Bound</span> <span class="op">==</span><span class="st">"Upper"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># MaxCombo</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>   MC_test &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">rho =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">.5</span>), <span class="dt">gamma =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="fl">.5</span>), <span class="dt">tau =</span> <span class="dv">-1</span>,</span>
<span id="cb22-3"><a href="#cb22-3"></a>                      <span class="dt">test =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</span>
<span id="cb22-4"><a href="#cb22-4"></a>                      <span class="dt">Analysis =</span> <span class="dv">1</span>,</span>
<span id="cb22-5"><a href="#cb22-5"></a>                      <span class="dt">analysisTimes =</span> <span class="dv">44</span>)</span>
<span id="cb22-6"><a href="#cb22-6"></a>   <span class="kw">gs_design_combo</span>(enrollRates,</span>
<span id="cb22-7"><a href="#cb22-7"></a>               failRates <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Scenario <span class="op">==</span><span class="st"> </span>g),</span>
<span id="cb22-8"><a href="#cb22-8"></a>               MC_test,</span>
<span id="cb22-9"><a href="#cb22-9"></a>               <span class="dt">alpha =</span> <span class="fl">0.025</span>,</span>
<span id="cb22-10"><a href="#cb22-10"></a>               <span class="dt">beta =</span> <span class="fl">0.1</span>,</span>
<span id="cb22-11"><a href="#cb22-11"></a>               <span class="dt">ratio =</span> <span class="dv">1</span>,</span>
<span id="cb22-12"><a href="#cb22-12"></a>               <span class="dt">binding =</span> <span class="ot">FALSE</span>,</span>
<span id="cb22-13"><a href="#cb22-13"></a>               <span class="dt">upper =</span> gs_spending_combo,</span>
<span id="cb22-14"><a href="#cb22-14"></a>               <span class="dt">upar =</span> <span class="kw">list</span>(<span class="dt">sf =</span> gsDesign<span class="op">::</span>sfLDOF, <span class="dt">total_spend =</span> <span class="fl">0.025</span>),</span>
<span id="cb22-15"><a href="#cb22-15"></a>               <span class="dt">lower =</span> gs_spending_combo,</span>
<span id="cb22-16"><a href="#cb22-16"></a>               <span class="dt">lpar =</span> <span class="kw">list</span>(<span class="dt">sf =</span> gsDesign<span class="op">::</span>sfLDOF, <span class="dt">total_spend =</span> <span class="fl">.1</span>)</span>
<span id="cb22-17"><a href="#cb22-17"></a>               )</span>
<span id="cb22-18"><a href="#cb22-18"></a><span class="er">}</span></span></code></pre></div>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-JTBook">
<p>Jennison, Christopher, and Bruce W. Turnbull. 2000. <em>Group Sequential Methods with Applications to Clinical Trials</em>. Boca Raton, FL: Chapman; Hall/CRC.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Keaven Anderson. Site built with pkgdown 1.6.1.
  </p>
  <p>Copyright Â© Merck Sharp &amp; Dohme Corp., a subsidiary of Merck &amp; Co., Inc., Kenilworth, NJ, USA.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
